@using Epam.ExtUsersLibrary.BLL.Interfaces
@using Epam.ExtUsersLibrary.BLL.Ioc;
@using Epam.ExtUsersLibrary.Entities;
@{
    if (IsAjax)
    {
        var userLogic = DependencyResolver.UserLogic;
        var awardLogic = DependencyResolver.AwardLogic;
        var allAwards = awardLogic.GetAll();
        if (IsPost)
        {
            var uid = int.Parse(Request.Form["uId"]);
            var aid = int.Parse(Request.Form["aId"]);
            var cur = userLogic.GetById(uid);
            if (cur.AwardsIds.Contains(aid))
            {
                Response.StatusCode = 8;
            }
            else
            {
                userLogic.GiveUserAward(uid,aid);
                awardLogic.GiveAwardUser(aid,uid);
                Response.Write(Json.Encode(awardLogic.GetById(aid)));
            }
        }
    }
}


